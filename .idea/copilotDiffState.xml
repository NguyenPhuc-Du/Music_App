<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/MainActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/MainActivity.java" />
              <option name="originalContent" value="package com.example.sound4you;&#10;&#10;import android.os.Bundle;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.view.View;&#10;import android.content.res.ColorStateList;&#10;import android.graphics.Color;&#10;import android.widget.ImageButton;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.navigation.NavController;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;import androidx.navigation.ui.NavigationUI;&#10;import androidx.activity.OnBackPressedCallback;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.ui.follow.FollowerListFragment;&#10;import com.example.sound4you.ui.follow.FollowingListFragment;&#10;import com.example.sound4you.ui.search.SearchFragment;&#10;import com.example.sound4you.ui.stream.NowPlayingBar;&#10;import com.example.sound4you.ui.stream.StreamTrackFragment;&#10;import com.example.sound4you.utils.MediaPlayerManager;&#10;import com.example.sound4you.presenter.like.LikePresenterImpl;&#10;import com.example.sound4you.ui.stream.LikeStreamView;&#10;import com.example.sound4you.presenter.follow.FollowPresenterImpl;&#10;import com.example.sound4you.ui.stream.FollowStreamView;&#10;import com.example.sound4you.ui.profile.UploadTrackListFragment;&#10;import com.example.sound4you.ui.profile.LikedTrackListFragment;&#10;import com.example.sound4you.ui.upload.UploadFragment;&#10;import com.google.android.material.bottomnavigation.BottomNavigationView;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;&#10;import java.util.List;&#10;&#10;public class MainActivity extends AppCompatActivity implements NowPlayingBar.OnNowPlayingActionListener {&#10;&#10;    private BottomNavigationView bottomNavigationView;&#10;    private NavController navController;&#10;&#10;    private MediaPlayerManager mediaPlayerManager;&#10;    private final Handler handler = new Handler(Looper.getMainLooper());&#10;    private NowPlayingBar nowPlayingBar;&#10;    private View includeNowPlaying;&#10;    private Track currentTrack;&#10;&#10;    private boolean isLiked = false;&#10;    private boolean isFollowing = false;&#10;    private boolean isNowPlayingVisible = false;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_main);&#10;&#10;        // Navigation setup&#10;        NavHostFragment navHostFragment =&#10;                (NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (navHostFragment != null)&#10;            navController = navHostFragment.getNavController();&#10;&#10;        bottomNavigationView = findViewById(R.id.bottomNav);&#10;        if (navController != null)&#10;            NavigationUI.setupWithNavController(bottomNavigationView, navController);&#10;&#10;        updateBottomNavVisibility();&#10;&#10;        getSupportFragmentManager().addOnBackStackChangedListener(() -&gt; {&#10;            updateBottomNavVisibility();&#10;            if (getSupportFragmentManager().getBackStackEntryCount() == 0 &amp;&amp; isNowPlayingVisible) {&#10;                restoreNowPlayingBar();&#10;            }&#10;        });&#10;&#10;        includeNowPlaying = findViewById(R.id.includedNowPlayingBar);&#10;        if (includeNowPlaying != null) {&#10;            includeNowPlaying.setVisibility(View.GONE);&#10;            nowPlayingBar = includeNowPlaying.findViewById(R.id.nowPlayingBar);&#10;            if (nowPlayingBar != null) nowPlayingBar.setOnNowPlayingActionListener(this);&#10;        }&#10;&#10;        mediaPlayerManager = MediaPlayerManager.getInstance();&#10;&#10;        if (nowPlayingBar != null) {&#10;            nowPlayingBar.setOnClickListener(v -&gt; {&#10;                if (currentTrack != null) {&#10;                    StreamTrackFragment fragment = StreamTrackFragment.newInstance(currentTrack);&#10;                    fragment.setNowPlayingBar(nowPlayingBar);&#10;&#10;                    getSupportFragmentManager()&#10;                            .beginTransaction()&#10;                            .setCustomAnimations(&#10;                                    R.anim.slide_up, R.anim.fade_out,&#10;                                    R.anim.fade_in, R.anim.slide_down&#10;                            )&#10;                            .replace(R.id.navHostFragment, fragment)&#10;                            .addToBackStack(&quot;StreamTrack&quot;)&#10;                            .commit();&#10;&#10;                    hideNowPlayingBar();&#10;                }&#10;            });&#10;        }&#10;&#10;        // Nút Back chung&#10;        getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {&#10;            @Override&#10;            public void handleOnBackPressed() {&#10;                int backCount = getSupportFragmentManager().getBackStackEntryCount();&#10;                if (backCount &gt; 0) {&#10;                    getSupportFragmentManager().popBackStack();&#10;                } else {&#10;                    finish();&#10;                }&#10;            }&#10;        });&#10;&#10;        startProgressBar();&#10;    }&#10;&#10;    private void updateBottomNavVisibility() {&#10;        boolean hide = false;&#10;&#10;        Fragment f = getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (f instanceof NavHostFragment) {&#10;            if (navController != null &amp;&amp; navController.getCurrentDestination() != null) {&#10;                int destId = navController.getCurrentDestination().getId();&#10;                if (destId == R.id.uploadFragment) hide = true;&#10;            }&#10;        } else if (f != null) {&#10;            if (f instanceof UploadTrackListFragment&#10;                    || f instanceof LikedTrackListFragment&#10;                    || f instanceof UploadFragment&#10;                    || f instanceof StreamTrackFragment&#10;                    || f instanceof FollowerListFragment&#10;                    || f instanceof FollowingListFragment&#10;                    || f instanceof SearchFragment) {&#10;                hide = true;&#10;            }&#10;        }&#10;&#10;        if (bottomNavigationView != null)&#10;            bottomNavigationView.setVisibility(hide ? View.GONE : View.VISIBLE);&#10;    }&#10;&#10;    public void hideBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.GONE);&#10;    }&#10;&#10;    public void showBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    public void showNowPlaying(Track track) {&#10;        if (track == null) return;&#10;        if (includeNowPlaying == null || nowPlayingBar == null) return;&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override&#10;            public void onLikeChanged(boolean liked) {}&#10;&#10;            @Override&#10;            public void onLikeStatusChecked(boolean liked) {&#10;                isLiked = liked;&#10;                ImageButton btnLike = nowPlayingBar.getLikeButton();&#10;                if (btnLike != null) {&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(&#10;                            liked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                }&#10;            }&#10;&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override public void onFollowChanged(boolean following) {}&#10;            @Override&#10;            public void onFollowStatusChecked(boolean followed) {&#10;                isFollowing = followed;&#10;                ImageButton btnFollow = nowPlayingBar.getFollowButton();&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(followed ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        likePresenter.checkLiked(firebaseUid, track.getId());&#10;        followPresenter.checkFollowed(firebaseUid, track.getUserId());&#10;&#10;        this.currentTrack = track;&#10;        nowPlayingBar.updateTrackInfo(track);&#10;&#10;        includeNowPlaying.setVisibility(View.VISIBLE);&#10;        includeNowPlaying.setAlpha(0f);&#10;        includeNowPlaying.animate()&#10;                .translationY(0)&#10;                .alpha(1f)&#10;                .setDuration(250)&#10;                .start();&#10;&#10;        isNowPlayingVisible = true;&#10;&#10;        String audioUrl = track.getAudioUrl();&#10;        if (audioUrl.contains(&quot;/upload/&quot;) &amp;&amp; !audioUrl.contains(&quot;/api/upload/&quot;)) {&#10;            audioUrl = audioUrl.replace(&quot;/upload/&quot;, &quot;/api/upload/&quot;);&#10;        }&#10;        mediaPlayerManager.play(audioUrl, () -&gt; {&#10;            if (nowPlayingBar != null) nowPlayingBar.setPlaying(true);&#10;        });&#10;    }&#10;&#10;    public void hideNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.VISIBLE) {&#10;            includeNowPlaying.animate()&#10;                    .translationY(includeNowPlaying.getHeight())&#10;                    .alpha(0f)&#10;                    .setDuration(200)&#10;                    .withEndAction(() -&gt; includeNowPlaying.setVisibility(View.GONE))&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public void restoreNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.GONE) {&#10;            includeNowPlaying.setVisibility(View.VISIBLE);&#10;            includeNowPlaying.setAlpha(0f);&#10;            includeNowPlaying.animate()&#10;                    .translationY(0)&#10;                    .alpha(1f)&#10;                    .setDuration(250)&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public boolean isNowPlayingVisible() {&#10;        return isNowPlayingVisible;&#10;    }&#10;&#10;    @Override&#10;    public void onPlayPauseClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào đang phát&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;        mediaPlayerManager.toggle();&#10;        if (nowPlayingBar != null)&#10;            nowPlayingBar.setPlaying(mediaPlayerManager.isPlaying());&#10;    }&#10;&#10;    @Override&#10;    public void onLikeClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào để thích&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        isLiked = !isLiked;&#10;        ImageButton btnLike = nowPlayingBar != null ? nowPlayingBar.getLikeButton() : null;&#10;        int color = isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK;&#10;        if (btnLike != null) btnLike.setImageTintList(ColorStateList.valueOf(color));&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override public void onLikeChanged(boolean liked) { isLiked = liked; }&#10;            @Override public void onLikeStatusChecked(boolean liked) {}&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override&#10;            public void onError(String msg) {&#10;                isLiked = !isLiked;&#10;                if (btnLike != null)&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            likePresenter.likeTrack(firebaseUid, currentTrack.getId(), !isLiked);&#10;    }&#10;&#10;    @Override&#10;    public void onFollowClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có nghệ sĩ nào để theo dõi&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String firebaseUid = null;&#10;        if (FirebaseAuth.getInstance().getCurrentUser() != null)&#10;            firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        int userId = currentTrack.getUserId();&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override&#10;            public void onFollowChanged(boolean following) {&#10;                isFollowing = following;&#10;                ImageButton btnFollow = nowPlayingBar != null ? nowPlayingBar.getFollowButton() : null;&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(following ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onFollowStatusChecked(boolean followed) {}&#10;            @Override public void onError(String msg) {&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            followPresenter.followUser(firebaseUid, userId, isFollowing);&#10;    }&#10;&#10;    private void startProgressBar() {&#10;        handler.postDelayed(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                if (mediaPlayerManager != null &amp;&amp; mediaPlayerManager.isPlaying()) {&#10;                    int duration = mediaPlayerManager.getDuration();&#10;                    if (duration &gt; 0 &amp;&amp; nowPlayingBar != null) {&#10;                        int progress = mediaPlayerManager.getCurrentPosition() * 100 / duration;&#10;                        nowPlayingBar.updateProcess(progress);&#10;                    }&#10;                }&#10;                handler.postDelayed(this, 300);&#10;            }&#10;        }, 300);&#10;    }&#10;&#10;    @Override&#10;    protected void onPause() {&#10;        super.onPause();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        startProgressBar();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        mediaPlayerManager.release();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you;&#10;&#10;import android.os.Bundle;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.view.View;&#10;import android.content.res.ColorStateList;&#10;import android.graphics.Color;&#10;import android.widget.ImageButton;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.navigation.NavController;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;import androidx.navigation.ui.NavigationUI;&#10;import androidx.activity.OnBackPressedCallback;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.ui.follow.FollowerListFragment;&#10;import com.example.sound4you.ui.follow.FollowingListFragment;&#10;import com.example.sound4you.ui.search.SearchFragment;&#10;import com.example.sound4you.ui.stream.NowPlayingBar;&#10;import com.example.sound4you.ui.stream.StreamTrackFragment;&#10;import com.example.sound4you.utils.MediaPlayerManager;&#10;import com.example.sound4you.presenter.like.LikePresenterImpl;&#10;import com.example.sound4you.ui.stream.LikeStreamView;&#10;import com.example.sound4you.presenter.follow.FollowPresenterImpl;&#10;import com.example.sound4you.ui.stream.FollowStreamView;&#10;import com.example.sound4you.ui.profile.UploadTrackListFragment;&#10;import com.example.sound4you.ui.profile.LikedTrackListFragment;&#10;import com.example.sound4you.ui.upload.UploadFragment;&#10;import com.google.android.material.bottomnavigation.BottomNavigationView;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;&#10;import java.util.List;&#10;&#10;public class MainActivity extends AppCompatActivity implements NowPlayingBar.OnNowPlayingActionListener {&#10;&#10;    private BottomNavigationView bottomNavigationView;&#10;    private NavController navController;&#10;&#10;    private MediaPlayerManager mediaPlayerManager;&#10;    private final Handler handler = new Handler(Looper.getMainLooper());&#10;    private NowPlayingBar nowPlayingBar;&#10;    private View includeNowPlaying;&#10;    private Track currentTrack;&#10;&#10;    private boolean isLiked = false;&#10;    private boolean isFollowing = false;&#10;    private boolean isNowPlayingVisible = false;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_main);&#10;&#10;        // Navigation setup&#10;        NavHostFragment navHostFragment =&#10;                (NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (navHostFragment != null)&#10;            navController = navHostFragment.getNavController();&#10;&#10;        bottomNavigationView = findViewById(R.id.bottomNav);&#10;        if (navController != null)&#10;            NavigationUI.setupWithNavController(bottomNavigationView, navController);&#10;&#10;        updateBottomNavVisibility();&#10;&#10;        getSupportFragmentManager().addOnBackStackChangedListener(() -&gt; {&#10;            updateBottomNavVisibility();&#10;            if (getSupportFragmentManager().getBackStackEntryCount() == 0 &amp;&amp; isNowPlayingVisible) {&#10;                restoreNowPlayingBar();&#10;            }&#10;        });&#10;&#10;        includeNowPlaying = findViewById(R.id.includedNowPlayingBar);&#10;        if (includeNowPlaying != null) {&#10;            includeNowPlaying.setVisibility(View.GONE);&#10;            nowPlayingBar = includeNowPlaying.findViewById(R.id.nowPlayingBar);&#10;            if (nowPlayingBar != null) nowPlayingBar.setOnNowPlayingActionListener(this);&#10;        }&#10;&#10;        mediaPlayerManager = MediaPlayerManager.getInstance();&#10;&#10;        if (nowPlayingBar != null) {&#10;            nowPlayingBar.setOnClickListener(v -&gt; {&#10;                if (currentTrack != null) {&#10;                    StreamTrackFragment fragment = StreamTrackFragment.newInstance(currentTrack);&#10;                    fragment.setNowPlayingBar(nowPlayingBar);&#10;&#10;                    getSupportFragmentManager()&#10;                            .beginTransaction()&#10;                            .setCustomAnimations(&#10;                                    R.anim.slide_up, R.anim.fade_out,&#10;                                    R.anim.fade_in, R.anim.slide_down&#10;                            )&#10;                            .replace(R.id.navHostFragment, fragment)&#10;                            .addToBackStack(&quot;StreamTrack&quot;)&#10;                            .commit();&#10;&#10;                    hideNowPlayingBar();&#10;                }&#10;            });&#10;        }&#10;&#10;        // Nút Back chung&#10;        getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {&#10;            @Override&#10;            public void handleOnBackPressed() {&#10;                int backCount = getSupportFragmentManager().getBackStackEntryCount();&#10;                if (backCount &gt; 0) {&#10;                    getSupportFragmentManager().popBackStack();&#10;                } else {&#10;                    finish();&#10;                }&#10;            }&#10;        });&#10;&#10;        startProgressBar();&#10;    }&#10;&#10;    private void updateBottomNavVisibility() {&#10;        boolean hide = false;&#10;&#10;        Fragment f = getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (f instanceof NavHostFragment) {&#10;            if (navController != null &amp;&amp; navController.getCurrentDestination() != null) {&#10;                int destId = navController.getCurrentDestination().getId();&#10;                if (destId == R.id.uploadFragment) hide = true;&#10;            }&#10;        } else if (f != null) {&#10;            if (f instanceof UploadTrackListFragment&#10;                    || f instanceof LikedTrackListFragment&#10;                    || f instanceof UploadFragment&#10;                    || f instanceof StreamTrackFragment&#10;                    || f instanceof FollowerListFragment&#10;                    || f instanceof FollowingListFragment&#10;                    || f instanceof SearchFragment) {&#10;                hide = true;&#10;            }&#10;        }&#10;&#10;        if (bottomNavigationView != null)&#10;            bottomNavigationView.setVisibility(hide ? View.GONE : View.VISIBLE);&#10;    }&#10;&#10;    public void hideBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.GONE);&#10;    }&#10;&#10;    public void showBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    public void showNowPlaying(Track track) {&#10;        if (track == null) return;&#10;        if (includeNowPlaying == null || nowPlayingBar == null) return;&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override&#10;            public void onLikeChanged(boolean liked) {}&#10;&#10;            @Override&#10;            public void onLikeStatusChecked(boolean liked) {&#10;                isLiked = liked;&#10;                ImageButton btnLike = nowPlayingBar.getLikeButton();&#10;                if (btnLike != null) {&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(&#10;                            liked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                }&#10;            }&#10;&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override public void onFollowChanged(boolean following) {}&#10;            @Override&#10;            public void onFollowStatusChecked(boolean followed) {&#10;                isFollowing = followed;&#10;                ImageButton btnFollow = nowPlayingBar.getFollowButton();&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(followed ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        likePresenter.checkLiked(firebaseUid, track.getId());&#10;        followPresenter.checkFollowed(firebaseUid, track.getUserId());&#10;&#10;        this.currentTrack = track;&#10;        nowPlayingBar.updateTrackInfo(track);&#10;&#10;        includeNowPlaying.setVisibility(View.VISIBLE);&#10;        includeNowPlaying.setAlpha(0f);&#10;        includeNowPlaying.animate()&#10;                .translationY(0)&#10;                .alpha(1f)&#10;                .setDuration(250)&#10;                .start();&#10;&#10;        isNowPlayingVisible = true;&#10;&#10;        String audioUrl = track.getAudioUrl();&#10;        if (audioUrl.contains(&quot;/upload/&quot;) &amp;&amp; !audioUrl.contains(&quot;/api/upload/&quot;)) {&#10;            audioUrl = audioUrl.replace(&quot;/upload/&quot;, &quot;/api/upload/&quot;);&#10;        }&#10;        mediaPlayerManager.play(audioUrl, () -&gt; {&#10;            if (nowPlayingBar != null) nowPlayingBar.setPlaying(true);&#10;        });&#10;    }&#10;&#10;    public void hideNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.VISIBLE) {&#10;            includeNowPlaying.animate()&#10;                    .translationY(includeNowPlaying.getHeight())&#10;                    .alpha(0f)&#10;                    .setDuration(200)&#10;                    .withEndAction(() -&gt; includeNowPlaying.setVisibility(View.GONE))&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public void restoreNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.GONE) {&#10;            includeNowPlaying.setVisibility(View.VISIBLE);&#10;            includeNowPlaying.setAlpha(0f);&#10;            includeNowPlaying.animate()&#10;                    .translationY(0)&#10;                    .alpha(1f)&#10;                    .setDuration(250)&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public boolean isNowPlayingVisible() {&#10;        return isNowPlayingVisible;&#10;    }&#10;&#10;    @Override&#10;    public void onPlayPauseClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào đang phát&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;        mediaPlayerManager.toggle();&#10;        if (nowPlayingBar != null)&#10;            nowPlayingBar.setPlaying(mediaPlayerManager.isPlaying());&#10;    }&#10;&#10;    @Override&#10;    public void onLikeClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào để thích&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        isLiked = !isLiked;&#10;        ImageButton btnLike = nowPlayingBar != null ? nowPlayingBar.getLikeButton() : null;&#10;        int color = isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK;&#10;        if (btnLike != null) btnLike.setImageTintList(ColorStateList.valueOf(color));&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override public void onLikeChanged(boolean liked) { isLiked = liked; }&#10;            @Override public void onLikeStatusChecked(boolean liked) {}&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override&#10;            public void onError(String msg) {&#10;                isLiked = !isLiked;&#10;                if (btnLike != null)&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            likePresenter.likeTrack(firebaseUid, currentTrack.getId(), !isLiked);&#10;    }&#10;&#10;    @Override&#10;    public void onFollowClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có nghệ sĩ nào để theo dõi&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String firebaseUid = null;&#10;        if (FirebaseAuth.getInstance().getCurrentUser() != null)&#10;            firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        int userId = currentTrack.getUserId();&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override&#10;            public void onFollowChanged(boolean following) {&#10;                isFollowing = following;&#10;                ImageButton btnFollow = nowPlayingBar != null ? nowPlayingBar.getFollowButton() : null;&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(following ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onFollowStatusChecked(boolean followed) {}&#10;            @Override public void onError(String msg) {&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            followPresenter.followUser(firebaseUid, userId, isFollowing);&#10;    }&#10;&#10;    private void startProgressBar() {&#10;        handler.postDelayed(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                if (mediaPlayerManager != null &amp;&amp; mediaPlayerManager.isPlaying()) {&#10;                    int duration = mediaPlayerManager.getDuration();&#10;                    if (duration &gt; 0 &amp;&amp; nowPlayingBar != null) {&#10;                        int progress = mediaPlayerManager.getCurrentPosition() * 100 / duration;&#10;                        nowPlayingBar.updateProcess(progress);&#10;                    }&#10;                }&#10;                handler.postDelayed(this, 300);&#10;            }&#10;        }, 300);&#10;    }&#10;&#10;    @Override&#10;    protected void onPause() {&#10;        super.onPause();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        startProgressBar();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        mediaPlayerManager.release();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/auth/LoginFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/auth/LoginFragment.java" />
              <option name="originalContent" value="package com.example.sound4you.ui.auth;&#10;&#10;import android.os.Bundle;&#10;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import android.content.Intent;&#10;import android.widget.Button;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.presenter.auth.LoginPresenterImpl;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.ui.admin.AdminActivity;&#10;&#10;import com.google.android.material.textfield.TextInputEditText;&#10;&#10;public class LoginFragment extends Fragment implements AuthView{&#10;&#10;    private TextInputEditText emailInput;&#10;    private TextInputEditText passwordInput;&#10;    private ProgressBar progressBar;&#10;    private Button loginButton;&#10;    private LoginPresenterImpl presenter;&#10;&#10;    public LoginFragment() {&#10;&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater,&#10;                             @Nullable ViewGroup container,&#10;                             @Nullable Bundle savedInstanceState) {&#10;&#10;        View view = inflater.inflate(R.layout.fragment_login, container, false);&#10;        emailInput = view.findViewById(R.id.emailInput);&#10;        passwordInput = view.findViewById(R.id.passwordInput);&#10;        loginButton = view.findViewById(R.id.loginButton);&#10;        progressBar = new ProgressBar(requireContext());&#10;&#10;        presenter = new LoginPresenterImpl(this, requireContext());&#10;        loginButton.setOnClickListener(v -&gt; {&#10;            String email = emailInput.getText().toString();&#10;            String password = passwordInput.getText().toString();&#10;            presenter.login(email, password);&#10;        });&#10;&#10;        TextView tvForgotPassword = view.findViewById(R.id.forgotPassword);&#10;        TextView tvGotoRegister = view.findViewById(R.id.registerAccount);&#10;&#10;        tvForgotPassword.setOnClickListener(v-&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_passwordForgettingFragment);&#10;        });&#10;&#10;        tvGotoRegister.setOnClickListener(v -&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_registerFragment);&#10;        });&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void showLoading() {&#10;        progressBar.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;        progressBar.setVisibility(View.GONE);&#10;    }&#10;&#10;    @Override&#10;    public void onSuccess (String message) {&#10;        if (message != null &amp;&amp; message.equals(&quot;admin&quot;)) {&#10;            startActivity(new Intent(getContext(), AdminActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;        else {&#10;            startActivity(new Intent(getContext(), MainActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onError (String message) {&#10;        Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.sound4you.ui.auth;&#10;&#10;import android.os.Bundle;&#10;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import android.content.Intent;&#10;import android.widget.Button;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.presenter.auth.LoginPresenterImpl;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.ui.admin.AdminActivity;&#10;&#10;import com.google.android.material.textfield.TextInputEditText;&#10;&#10;public class LoginFragment extends Fragment implements AuthView{&#10;&#10;    private TextInputEditText emailInput;&#10;    private TextInputEditText passwordInput;&#10;    private ProgressBar progressBar;&#10;    private Button loginButton;&#10;    private LoginPresenterImpl presenter;&#10;&#10;    public LoginFragment() {&#10;&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater,&#10;                             @Nullable ViewGroup container,&#10;                             @Nullable Bundle savedInstanceState) {&#10;&#10;        View view = inflater.inflate(R.layout.fragment_login, container, false);&#10;        emailInput = view.findViewById(R.id.emailInput);&#10;        passwordInput = view.findViewById(R.id.passwordInput);&#10;        loginButton = view.findViewById(R.id.loginButton);&#10;        progressBar = new ProgressBar(requireContext());&#10;&#10;        presenter = new LoginPresenterImpl(this, requireContext());&#10;        loginButton.setOnClickListener(v -&gt; {&#10;            String email = emailInput.getText().toString();&#10;            String password = passwordInput.getText().toString();&#10;            presenter.login(email, password);&#10;        });&#10;&#10;        TextView tvForgotPassword = view.findViewById(R.id.forgotPassword);&#10;        TextView tvGotoRegister = view.findViewById(R.id.registerAccount);&#10;&#10;        tvForgotPassword.setOnClickListener(v-&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_passwordForgettingFragment);&#10;        });&#10;&#10;        tvGotoRegister.setOnClickListener(v -&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_registerFragment);&#10;        });&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void showLoading() {&#10;        progressBar.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;        progressBar.setVisibility(View.GONE);&#10;    }&#10;&#10;    @Override&#10;    public void onSuccess (String message) {&#10;        if (message != null &amp;&amp; message.equals(&quot;admin&quot;)) {&#10;            startActivity(new Intent(getContext(), AdminActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;        else {&#10;            startActivity(new Intent(getContext(), MainActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onError (String message) {&#10;        Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>