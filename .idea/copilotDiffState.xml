<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/MainActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/MainActivity.java" />
              <option name="originalContent" value="package com.example.sound4you;&#10;&#10;import android.os.Bundle;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.view.View;&#10;import android.content.res.ColorStateList;&#10;import android.graphics.Color;&#10;import android.widget.ImageButton;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.navigation.NavController;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;import androidx.navigation.ui.NavigationUI;&#10;import androidx.activity.OnBackPressedCallback;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.ui.follow.FollowerListFragment;&#10;import com.example.sound4you.ui.follow.FollowingListFragment;&#10;import com.example.sound4you.ui.search.SearchFragment;&#10;import com.example.sound4you.ui.stream.NowPlayingBar;&#10;import com.example.sound4you.ui.stream.StreamTrackFragment;&#10;import com.example.sound4you.utils.MediaPlayerManager;&#10;import com.example.sound4you.presenter.like.LikePresenterImpl;&#10;import com.example.sound4you.ui.stream.LikeStreamView;&#10;import com.example.sound4you.presenter.follow.FollowPresenterImpl;&#10;import com.example.sound4you.ui.stream.FollowStreamView;&#10;import com.example.sound4you.ui.profile.UploadTrackListFragment;&#10;import com.example.sound4you.ui.profile.LikedTrackListFragment;&#10;import com.example.sound4you.ui.upload.UploadFragment;&#10;import com.google.android.material.bottomnavigation.BottomNavigationView;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;&#10;import java.util.List;&#10;&#10;public class MainActivity extends AppCompatActivity implements NowPlayingBar.OnNowPlayingActionListener {&#10;&#10;    private BottomNavigationView bottomNavigationView;&#10;    private NavController navController;&#10;&#10;    private MediaPlayerManager mediaPlayerManager;&#10;    private final Handler handler = new Handler(Looper.getMainLooper());&#10;    private NowPlayingBar nowPlayingBar;&#10;    private View includeNowPlaying;&#10;    private Track currentTrack;&#10;&#10;    private boolean isLiked = false;&#10;    private boolean isFollowing = false;&#10;    private boolean isNowPlayingVisible = false;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_main);&#10;&#10;        // Navigation setup&#10;        NavHostFragment navHostFragment =&#10;                (NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (navHostFragment != null)&#10;            navController = navHostFragment.getNavController();&#10;&#10;        bottomNavigationView = findViewById(R.id.bottomNav);&#10;        if (navController != null)&#10;            NavigationUI.setupWithNavController(bottomNavigationView, navController);&#10;&#10;        updateBottomNavVisibility();&#10;&#10;        getSupportFragmentManager().addOnBackStackChangedListener(() -&gt; {&#10;            updateBottomNavVisibility();&#10;            if (getSupportFragmentManager().getBackStackEntryCount() == 0 &amp;&amp; isNowPlayingVisible) {&#10;                restoreNowPlayingBar();&#10;            }&#10;        });&#10;&#10;        includeNowPlaying = findViewById(R.id.includedNowPlayingBar);&#10;        if (includeNowPlaying != null) {&#10;            includeNowPlaying.setVisibility(View.GONE);&#10;            nowPlayingBar = includeNowPlaying.findViewById(R.id.nowPlayingBar);&#10;            if (nowPlayingBar != null) nowPlayingBar.setOnNowPlayingActionListener(this);&#10;        }&#10;&#10;        mediaPlayerManager = MediaPlayerManager.getInstance();&#10;&#10;        if (nowPlayingBar != null) {&#10;            nowPlayingBar.setOnClickListener(v -&gt; {&#10;                if (currentTrack != null) {&#10;                    StreamTrackFragment fragment = StreamTrackFragment.newInstance(currentTrack);&#10;                    fragment.setNowPlayingBar(nowPlayingBar);&#10;&#10;                    getSupportFragmentManager()&#10;                            .beginTransaction()&#10;                            .setCustomAnimations(&#10;                                    R.anim.slide_up, R.anim.fade_out,&#10;                                    R.anim.fade_in, R.anim.slide_down&#10;                            )&#10;                            .replace(R.id.navHostFragment, fragment)&#10;                            .addToBackStack(&quot;StreamTrack&quot;)&#10;                            .commit();&#10;&#10;                    hideNowPlayingBar();&#10;                }&#10;            });&#10;        }&#10;&#10;        // Nút Back chung&#10;        getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {&#10;            @Override&#10;            public void handleOnBackPressed() {&#10;                int backCount = getSupportFragmentManager().getBackStackEntryCount();&#10;                if (backCount &gt; 0) {&#10;                    getSupportFragmentManager().popBackStack();&#10;                } else {&#10;                    finish();&#10;                }&#10;            }&#10;        });&#10;&#10;        startProgressBar();&#10;    }&#10;&#10;    private void updateBottomNavVisibility() {&#10;        boolean hide = false;&#10;&#10;        Fragment f = getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (f instanceof NavHostFragment) {&#10;            if (navController != null &amp;&amp; navController.getCurrentDestination() != null) {&#10;                int destId = navController.getCurrentDestination().getId();&#10;                if (destId == R.id.uploadFragment) hide = true;&#10;            }&#10;        } else if (f != null) {&#10;            if (f instanceof UploadTrackListFragment&#10;                    || f instanceof LikedTrackListFragment&#10;                    || f instanceof UploadFragment&#10;                    || f instanceof StreamTrackFragment&#10;                    || f instanceof FollowerListFragment&#10;                    || f instanceof FollowingListFragment&#10;                    || f instanceof SearchFragment) {&#10;                hide = true;&#10;            }&#10;        }&#10;&#10;        if (bottomNavigationView != null)&#10;            bottomNavigationView.setVisibility(hide ? View.GONE : View.VISIBLE);&#10;    }&#10;&#10;    public void hideBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.GONE);&#10;    }&#10;&#10;    public void showBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    public void showNowPlaying(Track track) {&#10;        if (track == null) return;&#10;        if (includeNowPlaying == null || nowPlayingBar == null) return;&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override&#10;            public void onLikeChanged(boolean liked) {}&#10;&#10;            @Override&#10;            public void onLikeStatusChecked(boolean liked) {&#10;                isLiked = liked;&#10;                ImageButton btnLike = nowPlayingBar.getLikeButton();&#10;                if (btnLike != null) {&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(&#10;                            liked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                }&#10;            }&#10;&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override public void onFollowChanged(boolean following) {}&#10;            @Override&#10;            public void onFollowStatusChecked(boolean followed) {&#10;                isFollowing = followed;&#10;                ImageButton btnFollow = nowPlayingBar.getFollowButton();&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(followed ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        likePresenter.checkLiked(firebaseUid, track.getId());&#10;        followPresenter.checkFollowed(firebaseUid, track.getUserId());&#10;&#10;        this.currentTrack = track;&#10;        nowPlayingBar.updateTrackInfo(track);&#10;&#10;        includeNowPlaying.setVisibility(View.VISIBLE);&#10;        includeNowPlaying.setAlpha(0f);&#10;        includeNowPlaying.animate()&#10;                .translationY(0)&#10;                .alpha(1f)&#10;                .setDuration(250)&#10;                .start();&#10;&#10;        isNowPlayingVisible = true;&#10;&#10;        String audioUrl = track.getAudioUrl();&#10;        if (audioUrl.contains(&quot;/upload/&quot;) &amp;&amp; !audioUrl.contains(&quot;/api/upload/&quot;)) {&#10;            audioUrl = audioUrl.replace(&quot;/upload/&quot;, &quot;/api/upload/&quot;);&#10;        }&#10;        mediaPlayerManager.play(audioUrl, () -&gt; {&#10;            if (nowPlayingBar != null) nowPlayingBar.setPlaying(true);&#10;        });&#10;    }&#10;&#10;    public void hideNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.VISIBLE) {&#10;            includeNowPlaying.animate()&#10;                    .translationY(includeNowPlaying.getHeight())&#10;                    .alpha(0f)&#10;                    .setDuration(200)&#10;                    .withEndAction(() -&gt; includeNowPlaying.setVisibility(View.GONE))&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public void restoreNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.GONE) {&#10;            includeNowPlaying.setVisibility(View.VISIBLE);&#10;            includeNowPlaying.setAlpha(0f);&#10;            includeNowPlaying.animate()&#10;                    .translationY(0)&#10;                    .alpha(1f)&#10;                    .setDuration(250)&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public boolean isNowPlayingVisible() {&#10;        return isNowPlayingVisible;&#10;    }&#10;&#10;    @Override&#10;    public void onPlayPauseClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào đang phát&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;        mediaPlayerManager.toggle();&#10;        if (nowPlayingBar != null)&#10;            nowPlayingBar.setPlaying(mediaPlayerManager.isPlaying());&#10;    }&#10;&#10;    @Override&#10;    public void onLikeClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào để thích&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        isLiked = !isLiked;&#10;        ImageButton btnLike = nowPlayingBar != null ? nowPlayingBar.getLikeButton() : null;&#10;        int color = isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK;&#10;        if (btnLike != null) btnLike.setImageTintList(ColorStateList.valueOf(color));&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override public void onLikeChanged(boolean liked) { isLiked = liked; }&#10;            @Override public void onLikeStatusChecked(boolean liked) {}&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override&#10;            public void onError(String msg) {&#10;                isLiked = !isLiked;&#10;                if (btnLike != null)&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            likePresenter.likeTrack(firebaseUid, currentTrack.getId(), !isLiked);&#10;    }&#10;&#10;    @Override&#10;    public void onFollowClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có nghệ sĩ nào để theo dõi&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String firebaseUid = null;&#10;        if (FirebaseAuth.getInstance().getCurrentUser() != null)&#10;            firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        int userId = currentTrack.getUserId();&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override&#10;            public void onFollowChanged(boolean following) {&#10;                isFollowing = following;&#10;                ImageButton btnFollow = nowPlayingBar != null ? nowPlayingBar.getFollowButton() : null;&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(following ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onFollowStatusChecked(boolean followed) {}&#10;            @Override public void onError(String msg) {&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            followPresenter.followUser(firebaseUid, userId, isFollowing);&#10;    }&#10;&#10;    private void startProgressBar() {&#10;        handler.postDelayed(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                if (mediaPlayerManager != null &amp;&amp; mediaPlayerManager.isPlaying()) {&#10;                    int duration = mediaPlayerManager.getDuration();&#10;                    if (duration &gt; 0 &amp;&amp; nowPlayingBar != null) {&#10;                        int progress = mediaPlayerManager.getCurrentPosition() * 100 / duration;&#10;                        nowPlayingBar.updateProcess(progress);&#10;                    }&#10;                }&#10;                handler.postDelayed(this, 300);&#10;            }&#10;        }, 300);&#10;    }&#10;&#10;    @Override&#10;    protected void onPause() {&#10;        super.onPause();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        startProgressBar();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        mediaPlayerManager.release();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you;&#10;&#10;import android.os.Bundle;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.view.View;&#10;import android.content.res.ColorStateList;&#10;import android.graphics.Color;&#10;import android.widget.ImageButton;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.navigation.NavController;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;import androidx.navigation.ui.NavigationUI;&#10;import androidx.activity.OnBackPressedCallback;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.ui.follow.FollowerListFragment;&#10;import com.example.sound4you.ui.follow.FollowingListFragment;&#10;import com.example.sound4you.ui.search.SearchFragment;&#10;import com.example.sound4you.ui.stream.NowPlayingBar;&#10;import com.example.sound4you.ui.stream.StreamTrackFragment;&#10;import com.example.sound4you.utils.MediaPlayerManager;&#10;import com.example.sound4you.presenter.like.LikePresenterImpl;&#10;import com.example.sound4you.ui.stream.LikeStreamView;&#10;import com.example.sound4you.presenter.follow.FollowPresenterImpl;&#10;import com.example.sound4you.ui.stream.FollowStreamView;&#10;import com.example.sound4you.ui.profile.UploadTrackListFragment;&#10;import com.example.sound4you.ui.profile.LikedTrackListFragment;&#10;import com.example.sound4you.ui.upload.UploadFragment;&#10;import com.google.android.material.bottomnavigation.BottomNavigationView;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;&#10;import java.util.List;&#10;&#10;public class MainActivity extends AppCompatActivity implements NowPlayingBar.OnNowPlayingActionListener {&#10;&#10;    private BottomNavigationView bottomNavigationView;&#10;    private NavController navController;&#10;&#10;    private MediaPlayerManager mediaPlayerManager;&#10;    private final Handler handler = new Handler(Looper.getMainLooper());&#10;    private NowPlayingBar nowPlayingBar;&#10;    private View includeNowPlaying;&#10;    private Track currentTrack;&#10;&#10;    private boolean isLiked = false;&#10;    private boolean isFollowing = false;&#10;    private boolean isNowPlayingVisible = false;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_main);&#10;&#10;        // Navigation setup&#10;        NavHostFragment navHostFragment =&#10;                (NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (navHostFragment != null)&#10;            navController = navHostFragment.getNavController();&#10;&#10;        bottomNavigationView = findViewById(R.id.bottomNav);&#10;        if (navController != null)&#10;            NavigationUI.setupWithNavController(bottomNavigationView, navController);&#10;&#10;        updateBottomNavVisibility();&#10;&#10;        getSupportFragmentManager().addOnBackStackChangedListener(() -&gt; {&#10;            updateBottomNavVisibility();&#10;            if (getSupportFragmentManager().getBackStackEntryCount() == 0 &amp;&amp; isNowPlayingVisible) {&#10;                restoreNowPlayingBar();&#10;            }&#10;        });&#10;&#10;        includeNowPlaying = findViewById(R.id.includedNowPlayingBar);&#10;        if (includeNowPlaying != null) {&#10;            includeNowPlaying.setVisibility(View.GONE);&#10;            nowPlayingBar = includeNowPlaying.findViewById(R.id.nowPlayingBar);&#10;            if (nowPlayingBar != null) nowPlayingBar.setOnNowPlayingActionListener(this);&#10;        }&#10;&#10;        mediaPlayerManager = MediaPlayerManager.getInstance();&#10;&#10;        if (nowPlayingBar != null) {&#10;            nowPlayingBar.setOnClickListener(v -&gt; {&#10;                if (currentTrack != null) {&#10;                    StreamTrackFragment fragment = StreamTrackFragment.newInstance(currentTrack);&#10;                    fragment.setNowPlayingBar(nowPlayingBar);&#10;&#10;                    getSupportFragmentManager()&#10;                            .beginTransaction()&#10;                            .setCustomAnimations(&#10;                                    R.anim.slide_up, R.anim.fade_out,&#10;                                    R.anim.fade_in, R.anim.slide_down&#10;                            )&#10;                            .replace(R.id.navHostFragment, fragment)&#10;                            .addToBackStack(&quot;StreamTrack&quot;)&#10;                            .commit();&#10;&#10;                    hideNowPlayingBar();&#10;                }&#10;            });&#10;        }&#10;&#10;        // Nút Back chung&#10;        getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {&#10;            @Override&#10;            public void handleOnBackPressed() {&#10;                int backCount = getSupportFragmentManager().getBackStackEntryCount();&#10;                if (backCount &gt; 0) {&#10;                    getSupportFragmentManager().popBackStack();&#10;                } else {&#10;                    finish();&#10;                }&#10;            }&#10;        });&#10;&#10;        startProgressBar();&#10;    }&#10;&#10;    private void updateBottomNavVisibility() {&#10;        boolean hide = false;&#10;&#10;        Fragment f = getSupportFragmentManager().findFragmentById(R.id.navHostFragment);&#10;        if (f instanceof NavHostFragment) {&#10;            if (navController != null &amp;&amp; navController.getCurrentDestination() != null) {&#10;                int destId = navController.getCurrentDestination().getId();&#10;                if (destId == R.id.uploadFragment) hide = true;&#10;            }&#10;        } else if (f != null) {&#10;            if (f instanceof UploadTrackListFragment&#10;                    || f instanceof LikedTrackListFragment&#10;                    || f instanceof UploadFragment&#10;                    || f instanceof StreamTrackFragment&#10;                    || f instanceof FollowerListFragment&#10;                    || f instanceof FollowingListFragment&#10;                    || f instanceof SearchFragment) {&#10;                hide = true;&#10;            }&#10;        }&#10;&#10;        if (bottomNavigationView != null)&#10;            bottomNavigationView.setVisibility(hide ? View.GONE : View.VISIBLE);&#10;    }&#10;&#10;    public void hideBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.GONE);&#10;    }&#10;&#10;    public void showBottomNav() {&#10;        if (bottomNavigationView != null) bottomNavigationView.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    public void showNowPlaying(Track track) {&#10;        if (track == null) return;&#10;        if (includeNowPlaying == null || nowPlayingBar == null) return;&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override&#10;            public void onLikeChanged(boolean liked) {}&#10;&#10;            @Override&#10;            public void onLikeStatusChecked(boolean liked) {&#10;                isLiked = liked;&#10;                ImageButton btnLike = nowPlayingBar.getLikeButton();&#10;                if (btnLike != null) {&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(&#10;                            liked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                }&#10;            }&#10;&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override public void onFollowChanged(boolean following) {}&#10;            @Override&#10;            public void onFollowStatusChecked(boolean followed) {&#10;                isFollowing = followed;&#10;                ImageButton btnFollow = nowPlayingBar.getFollowButton();&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(followed ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onError(String msg) {}&#10;        });&#10;&#10;        likePresenter.checkLiked(firebaseUid, track.getId());&#10;        followPresenter.checkFollowed(firebaseUid, track.getUserId());&#10;&#10;        this.currentTrack = track;&#10;        nowPlayingBar.updateTrackInfo(track);&#10;&#10;        includeNowPlaying.setVisibility(View.VISIBLE);&#10;        includeNowPlaying.setAlpha(0f);&#10;        includeNowPlaying.animate()&#10;                .translationY(0)&#10;                .alpha(1f)&#10;                .setDuration(250)&#10;                .start();&#10;&#10;        isNowPlayingVisible = true;&#10;&#10;        String audioUrl = track.getAudioUrl();&#10;        if (audioUrl.contains(&quot;/upload/&quot;) &amp;&amp; !audioUrl.contains(&quot;/api/upload/&quot;)) {&#10;            audioUrl = audioUrl.replace(&quot;/upload/&quot;, &quot;/api/upload/&quot;);&#10;        }&#10;        mediaPlayerManager.play(audioUrl, () -&gt; {&#10;            if (nowPlayingBar != null) nowPlayingBar.setPlaying(true);&#10;        });&#10;    }&#10;&#10;    public void hideNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.VISIBLE) {&#10;            includeNowPlaying.animate()&#10;                    .translationY(includeNowPlaying.getHeight())&#10;                    .alpha(0f)&#10;                    .setDuration(200)&#10;                    .withEndAction(() -&gt; includeNowPlaying.setVisibility(View.GONE))&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public void restoreNowPlayingBar() {&#10;        if (isNowPlayingVisible &amp;&amp; includeNowPlaying != null&#10;                &amp;&amp; includeNowPlaying.getVisibility() == View.GONE) {&#10;            includeNowPlaying.setVisibility(View.VISIBLE);&#10;            includeNowPlaying.setAlpha(0f);&#10;            includeNowPlaying.animate()&#10;                    .translationY(0)&#10;                    .alpha(1f)&#10;                    .setDuration(250)&#10;                    .start();&#10;        }&#10;    }&#10;&#10;    public boolean isNowPlayingVisible() {&#10;        return isNowPlayingVisible;&#10;    }&#10;&#10;    @Override&#10;    public void onPlayPauseClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào đang phát&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;        mediaPlayerManager.toggle();&#10;        if (nowPlayingBar != null)&#10;            nowPlayingBar.setPlaying(mediaPlayerManager.isPlaying());&#10;    }&#10;&#10;    @Override&#10;    public void onLikeClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có bài hát nào để thích&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        isLiked = !isLiked;&#10;        ImageButton btnLike = nowPlayingBar != null ? nowPlayingBar.getLikeButton() : null;&#10;        int color = isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK;&#10;        if (btnLike != null) btnLike.setImageTintList(ColorStateList.valueOf(color));&#10;&#10;        String firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        LikePresenterImpl likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override public void onLikeChanged(boolean liked) { isLiked = liked; }&#10;            @Override public void onLikeStatusChecked(boolean liked) {}&#10;            @Override public void onTracksUpdated(List&lt;Track&gt; tracks) {}&#10;            @Override&#10;            public void onError(String msg) {&#10;                isLiked = !isLiked;&#10;                if (btnLike != null)&#10;                    btnLike.setImageTintList(ColorStateList.valueOf(isLiked ? Color.parseColor(&quot;#FF7A00&quot;) : Color.BLACK));&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            likePresenter.likeTrack(firebaseUid, currentTrack.getId(), !isLiked);&#10;    }&#10;&#10;    @Override&#10;    public void onFollowClicked() {&#10;        if (currentTrack == null) {&#10;            Toast.makeText(this, &quot;Không có nghệ sĩ nào để theo dõi&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String firebaseUid = null;&#10;        if (FirebaseAuth.getInstance().getCurrentUser() != null)&#10;            firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        int userId = currentTrack.getUserId();&#10;        FollowPresenterImpl followPresenter = new FollowPresenterImpl(new FollowStreamView() {&#10;            @Override&#10;            public void onFollowChanged(boolean following) {&#10;                isFollowing = following;&#10;                ImageButton btnFollow = nowPlayingBar != null ? nowPlayingBar.getFollowButton() : null;&#10;                if (btnFollow != null)&#10;                    btnFollow.setImageResource(following ? R.drawable.ic_followed : R.drawable.ic_follow);&#10;            }&#10;            @Override public void onFollowStatusChecked(boolean followed) {}&#10;            @Override public void onError(String msg) {&#10;                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        if (firebaseUid != null)&#10;            followPresenter.followUser(firebaseUid, userId, isFollowing);&#10;    }&#10;&#10;    private void startProgressBar() {&#10;        handler.postDelayed(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                if (mediaPlayerManager != null &amp;&amp; mediaPlayerManager.isPlaying()) {&#10;                    int duration = mediaPlayerManager.getDuration();&#10;                    if (duration &gt; 0 &amp;&amp; nowPlayingBar != null) {&#10;                        int progress = mediaPlayerManager.getCurrentPosition() * 100 / duration;&#10;                        nowPlayingBar.updateProcess(progress);&#10;                    }&#10;                }&#10;                handler.postDelayed(this, 300);&#10;            }&#10;        }, 300);&#10;    }&#10;&#10;    @Override&#10;    protected void onPause() {&#10;        super.onPause();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        startProgressBar();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        mediaPlayerManager.release();&#10;        handler.removeCallbacksAndMessages(null);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/data/repository/AuthRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/data/repository/AuthRepository.java" />
              <option name="originalContent" value="package com.example.sound4you.data.repository;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import com.example.sound4you.data.model.User;&#10;import com.example.sound4you.data.dao.UserDao;&#10;import com.example.sound4you.utils.ApiClient;&#10;&#10;import java.util.Map;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;&#10;public class AuthRepository {&#10;    private UserDao userDao;&#10;    private SharedPreferences sharedPreferences;&#10;&#10;    public AuthRepository(Context context) {&#10;        userDao = ApiClient.getClient().create(UserDao.class);&#10;        // unify with other code that uses &quot;AuthPreferences&quot;&#10;        sharedPreferences = context.getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;    }&#10;&#10;    public void register(User user, Callback&lt;Map&lt;String, String&gt;&gt; callback) {&#10;        userDao.register(user).enqueue(callback);&#10;    }&#10;&#10;    public void login(User user, Callback&lt;Map&lt;String, Object&gt;&gt; callback) {&#10;        userDao.login(user).enqueue(callback);&#10;    }&#10;&#10;    public void resetPassword(Map&lt;String, String&gt; data, Callback&lt;Map&lt;String, String&gt;&gt; callback) {&#10;        userDao.resetPassword(data).enqueue(callback);&#10;    }&#10;&#10;    public void saveToken(String token) {&#10;        // use same key as LoginPresenterImpl stores into SharedPreferences (&quot;Token&quot;)&#10;        sharedPreferences.edit().putString(&quot;Token&quot;, token).apply();&#10;    }&#10;&#10;    public String getToken() {&#10;        return sharedPreferences.getString(&quot;Token&quot;, null);&#10;    }&#10;&#10;    public void clearToken() {&#10;        sharedPreferences.edit().remove(&quot;Token&quot;).apply();&#10;    }&#10;&#10;    public void saveUserRole(int role) {&#10;        sharedPreferences.edit().putInt(&quot;UserRole&quot;, role).apply();&#10;    }&#10;&#10;    public int getUserRole() {&#10;        return sharedPreferences.getInt(&quot;UserRole&quot;, -1);&#10;    }&#10;&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you.data.repository;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import com.example.sound4you.data.model.User;&#10;import com.example.sound4you.data.dao.UserDao;&#10;import com.example.sound4you.utils.ApiClient;&#10;&#10;import java.util.Map;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;&#10;public class AuthRepository {&#10;    private UserDao userDao;&#10;    private SharedPreferences sharedPreferences;&#10;&#10;    public AuthRepository(Context context) {&#10;        userDao = ApiClient.getClient().create(UserDao.class);&#10;        // unify with other code that uses &quot;AuthPreferences&quot;&#10;        sharedPreferences = context.getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;    }&#10;&#10;    public void register(User user, Callback&lt;Map&lt;String, String&gt;&gt; callback) {&#10;        userDao.register(user).enqueue(callback);&#10;    }&#10;&#10;    public void login(User user, Callback&lt;Map&lt;String, Object&gt;&gt; callback) {&#10;        userDao.login(user).enqueue(callback);&#10;    }&#10;&#10;    public void resetPassword(Map&lt;String, String&gt; data, Callback&lt;Map&lt;String, String&gt;&gt; callback) {&#10;        userDao.resetPassword(data).enqueue(callback);&#10;    }&#10;&#10;    public void saveToken(String token) {&#10;        // use same key as LoginPresenterImpl stores into SharedPreferences (&quot;Token&quot;)&#10;        sharedPreferences.edit().putString(&quot;Token&quot;, token).apply();&#10;    }&#10;&#10;    public String getToken() {&#10;        return sharedPreferences.getString(&quot;Token&quot;, null);&#10;    }&#10;&#10;    public void clearToken() {&#10;        sharedPreferences.edit().remove(&quot;Token&quot;).apply();&#10;    }&#10;&#10;    public void saveUserRole(int role) {&#10;        sharedPreferences.edit().putInt(&quot;UserRole&quot;, role).apply();&#10;    }&#10;&#10;    public int getUserRole() {&#10;        return sharedPreferences.getInt(&quot;UserRole&quot;, -1);&#10;    }&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/presenter/auth/LoginPresenterImpl.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/presenter/auth/LoginPresenterImpl.java" />
              <option name="originalContent" value="package com.example.sound4you.presenter.auth;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;import android.util.Log;&#10;&#10;import com.example.sound4you.data.model.User;&#10;import com.example.sound4you.data.repository.AuthRepository;&#10;import com.example.sound4you.ui.auth.AuthView;&#10;import com.google.firebase.auth.AuthResult;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.auth.FirebaseUser;&#10;&#10;import java.util.Map;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class LoginPresenterImpl implements LoginPresenter {&#10;    private final AuthView authView;&#10;    private final AuthRepository authRepository;&#10;    private final Context context;&#10;    private final FirebaseAuth firebaseAuth;&#10;&#10;    public LoginPresenterImpl(AuthView authView, Context context) {&#10;        this.authView = authView;&#10;        this.authRepository = new AuthRepository(context);&#10;        this.context = context;&#10;        this.firebaseAuth = FirebaseAuth.getInstance();&#10;    }&#10;&#10;    @Override&#10;    public void login(String email, String password) {&#10;        authView.showLoading();&#10;        User user = new User(email, password);&#10;&#10;        authRepository.login(user, new Callback&lt;Map&lt;String, Object&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;Map&lt;String, Object&gt;&gt; call, Response&lt;Map&lt;String, Object&gt;&gt; response) {&#10;                authView.hideLoading();&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    Map&lt;String, Object&gt; data = response.body();&#10;                    Object token = data.get(&quot;token&quot;);&#10;                    Map&lt;String, Object&gt; userData = (Map&lt;String, Object&gt;) data.get(&quot;user&quot;);&#10;&#10;                    if (token != null &amp;&amp; userData != null) {&#10;                        Object roleObj = userData.get(&quot;role&quot;);&#10;                        int role = 0;&#10;                        if (roleObj instanceof Double) {&#10;                            role = ((Double) roleObj).intValue();&#10;                        } else if (roleObj instanceof Integer) {&#10;                            role = (Integer) roleObj;&#10;                        }&#10;&#10;                        authRepository.saveToken(token.toString());&#10;                        authRepository.saveUserRole(role);&#10;&#10;                        int finalRole = role;&#10;&#10;                        // IMPORTANT: sign in to Firebase using the user's email/password so the Firebase UID&#10;                        // matches the one created during registration (if registration used email/password).&#10;                        firebaseAuth.signInWithEmailAndPassword(email, password)&#10;                                .addOnSuccessListener((AuthResult result) -&gt; {&#10;                                    FirebaseUser firebaseUser = result.getUser();&#10;                                    if (firebaseUser != null) {&#10;                                        String uid = firebaseUser.getUid();&#10;                                        Log.d(&quot;LoginPresenter&quot;, &quot;Firebase UID: &quot; + uid);&#10;&#10;                                        SharedPreferences prefs = context.getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;                                        prefs.edit()&#10;                                                .putString(&quot;Token&quot;, token.toString())&#10;                                                .putString(&quot;UID&quot;, uid)&#10;                                                // store role string for routing later&#10;                                                .putString(&quot;Role&quot;, finalRole == 1 ? &quot;admin&quot; : &quot;user&quot;)&#10;                                                .apply();&#10;                                    }&#10;&#10;                                    if (finalRole == 1) {&#10;                                        authView.onSuccess(&quot;admin&quot;);&#10;                                    } else {&#10;                                        authView.onSuccess(&quot;user&quot;);&#10;                                    }&#10;                                })&#10;                                .addOnFailureListener(e -&gt; {&#10;                                    Log.w(&quot;LoginPresenter&quot;, &quot;Firebase sign-in with email failed, trying anonymous fallback&quot;, e);&#10;                                    // Fallback: sign in anonymously to at least obtain a Firebase UID if needed.&#10;                                    firebaseAuth.signInAnonymously()&#10;                                            .addOnSuccessListener(result -&gt; {&#10;                                                FirebaseUser firebaseUser = result.getUser();&#10;                                                if (firebaseUser != null) {&#10;                                                    String uid = firebaseUser.getUid();&#10;                                                    Log.d(&quot;LoginPresenter&quot;, &quot;Firebase anonymous UID: &quot; + uid);&#10;&#10;                                                    SharedPreferences prefs = context.getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;                                                    prefs.edit()&#10;                                                            .putString(&quot;Token&quot;, token.toString())&#10;                                                            .putString(&quot;UID&quot;, uid)&#10;                                                            .putString(&quot;Role&quot;, finalRole == 1 ? &quot;admin&quot; : &quot;user&quot;)&#10;                                                            .apply();&#10;                                                }&#10;&#10;                                                if (finalRole == 1) {&#10;                                                    authView.onSuccess(&quot;admin&quot;);&#10;                                                } else {&#10;                                                    authView.onSuccess(&quot;user&quot;);&#10;                                                }&#10;                                            })&#10;                                            .addOnFailureListener(ex -&gt; {&#10;                                                Log.e(&quot;LoginPresenter&quot;, &quot;Firebase sign-in failed&quot;, ex);&#10;                                                authView.onError(&quot;Không thể kết nối Firebase!&quot;);&#10;                                            });&#10;                                });&#10;&#10;                    } else {&#10;                        authView.onError(&quot;Đăng nhập thất bại!&quot;);&#10;                    }&#10;                } else {&#10;                    authView.onError(&quot;Sai email hoặc mật khẩu&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;Map&lt;String, Object&gt;&gt; call, Throwable t) {&#10;                authView.hideLoading();&#10;                authView.onError(&quot;Lỗi mạng&quot;);&#10;            }&#10;        });&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you.presenter.auth;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;import android.util.Log;&#10;&#10;import com.example.sound4you.data.model.User;&#10;import com.example.sound4you.data.repository.AuthRepository;&#10;import com.example.sound4you.ui.auth.AuthView;&#10;import com.google.firebase.auth.AuthResult;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.auth.FirebaseUser;&#10;&#10;import java.util.Map;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class LoginPresenterImpl implements LoginPresenter {&#10;    private final AuthView authView;&#10;    private final AuthRepository authRepository;&#10;    private final Context context;&#10;    private final FirebaseAuth firebaseAuth;&#10;&#10;    public LoginPresenterImpl(AuthView authView, Context context) {&#10;        this.authView = authView;&#10;        this.authRepository = new AuthRepository(context);&#10;        this.context = context;&#10;        this.firebaseAuth = FirebaseAuth.getInstance();&#10;    }&#10;&#10;    @Override&#10;    public void login(String email, String password) {&#10;        authView.showLoading();&#10;        User user = new User(email, password);&#10;&#10;        authRepository.login(user, new Callback&lt;Map&lt;String, Object&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;Map&lt;String, Object&gt;&gt; call, Response&lt;Map&lt;String, Object&gt;&gt; response) {&#10;                authView.hideLoading();&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    Map&lt;String, Object&gt; data = response.body();&#10;                    Object token = data.get(&quot;token&quot;);&#10;                    Map&lt;String, Object&gt; userData = (Map&lt;String, Object&gt;) data.get(&quot;user&quot;);&#10;&#10;                    if (token != null &amp;&amp; userData != null) {&#10;                        Object roleObj = userData.get(&quot;role&quot;);&#10;                        int role = 0;&#10;                        if (roleObj instanceof Double) {&#10;                            role = ((Double) roleObj).intValue();&#10;                        } else if (roleObj instanceof Integer) {&#10;                            role = (Integer) roleObj;&#10;                        }&#10;&#10;                        authRepository.saveToken(token.toString());&#10;                        authRepository.saveUserRole(role);&#10;&#10;                        int finalRole = role;&#10;&#10;                        // IMPORTANT: sign in to Firebase using the user's email/password so the Firebase UID&#10;                        // matches the one created during registration (if registration used email/password).&#10;                        firebaseAuth.signInWithEmailAndPassword(email, password)&#10;                                .addOnSuccessListener((AuthResult result) -&gt; {&#10;                                    FirebaseUser firebaseUser = result.getUser();&#10;                                    if (firebaseUser != null) {&#10;                                        String uid = firebaseUser.getUid();&#10;                                        Log.d(&quot;LoginPresenter&quot;, &quot;Firebase UID: &quot; + uid);&#10;&#10;                                        SharedPreferences prefs = context.getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;                                        prefs.edit()&#10;                                                .putString(&quot;Token&quot;, token.toString())&#10;                                                .putString(&quot;UID&quot;, uid)&#10;                                                // store role string for routing later&#10;                                                .putString(&quot;Role&quot;, finalRole == 1 ? &quot;admin&quot; : &quot;user&quot;)&#10;                                                .apply();&#10;                                    }&#10;&#10;                                    if (finalRole == 1) {&#10;                                        authView.onSuccess(&quot;admin&quot;);&#10;                                    } else {&#10;                                        authView.onSuccess(&quot;user&quot;);&#10;                                    }&#10;                                })&#10;                                .addOnFailureListener(e -&gt; {&#10;                                    Log.w(&quot;LoginPresenter&quot;, &quot;Firebase sign-in with email failed, trying anonymous fallback&quot;, e);&#10;                                    // Fallback: sign in anonymously to at least obtain a Firebase UID if needed.&#10;                                    firebaseAuth.signInAnonymously()&#10;                                            .addOnSuccessListener(result -&gt; {&#10;                                                FirebaseUser firebaseUser = result.getUser();&#10;                                                if (firebaseUser != null) {&#10;                                                    String uid = firebaseUser.getUid();&#10;                                                    Log.d(&quot;LoginPresenter&quot;, &quot;Firebase anonymous UID: &quot; + uid);&#10;&#10;                                                    SharedPreferences prefs = context.getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;                                                    prefs.edit()&#10;                                                            .putString(&quot;Token&quot;, token.toString())&#10;                                                            .putString(&quot;UID&quot;, uid)&#10;                                                            .putString(&quot;Role&quot;, finalRole == 1 ? &quot;admin&quot; : &quot;user&quot;)&#10;                                                            .apply();&#10;                                                }&#10;&#10;                                                if (finalRole == 1) {&#10;                                                    authView.onSuccess(&quot;admin&quot;);&#10;                                                } else {&#10;                                                    authView.onSuccess(&quot;user&quot;);&#10;                                                }&#10;                                            })&#10;                                            .addOnFailureListener(ex -&gt; {&#10;                                                Log.e(&quot;LoginPresenter&quot;, &quot;Firebase sign-in failed&quot;, ex);&#10;                                                authView.onError(&quot;Không thể kết nối Firebase!&quot;);&#10;                                            });&#10;                                });&#10;&#10;                    } else {&#10;                        authView.onError(&quot;Đăng nhập thất bại!&quot;);&#10;                    }&#10;                } else {&#10;                    authView.onError(&quot;Sai email hoặc mật khẩu&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;Map&lt;String, Object&gt;&gt; call, Throwable t) {&#10;                authView.hideLoading();&#10;                authView.onError(&quot;Lỗi mạng&quot;);&#10;            }&#10;        });&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/admin/AdminActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/admin/AdminActivity.java" />
              <option name="originalContent" value="package com.example.sound4you.ui.admin;&#10;&#10;import android.os.Bundle;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.example.sound4you.R;&#10;&#10;public class AdminActivity extends AppCompatActivity {&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_admin);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you.ui.admin;&#10;&#10;import android.os.Bundle;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.example.sound4you.R;&#10;&#10;public class AdminActivity extends AppCompatActivity {&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_admin);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/auth/AuthActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/auth/AuthActivity.java" />
              <option name="originalContent" value="package com.example.sound4you.ui.auth;&#10;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.os.Bundle;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.ui.admin.AdminActivity;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.auth.FirebaseUser;&#10;&#10;public class AuthActivity extends AppCompatActivity {&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;&#10;        FirebaseAuth auth = FirebaseAuth.getInstance();&#10;        FirebaseUser user = auth.getCurrentUser();&#10;        SharedPreferences prefs = getSharedPreferences(&quot;AuthPreferences&quot;, MODE_PRIVATE);&#10;&#10;        // Determine role stored in preferences (if any)&#10;        String role = prefs.getString(&quot;Role&quot;, null); // expected values: &quot;admin&quot; or &quot;user&quot;&#10;&#10;        if (user != null) {&#10;            // If Firebase user exists, route by stored role if present, otherwise go to main&#10;            if (role != null &amp;&amp; role.equals(&quot;admin&quot;)) {&#10;                startActivity(new Intent(this, AdminActivity.class));&#10;                finish();&#10;                return;&#10;            } else {&#10;                startActivity(new Intent(this, MainActivity.class));&#10;                finish();&#10;                return;&#10;            }&#10;        } else {&#10;            String uid = prefs.getString(&quot;UID&quot;, null);&#10;            String token = prefs.getString(&quot;Token&quot;, null);&#10;&#10;            // Only attempt anonymous sign-in if we still have UID or Token and role is present.&#10;            if ((uid != null || token != null) &amp;&amp; role != null) {&#10;                auth.signInAnonymously()&#10;                        .addOnSuccessListener(result -&gt; {&#10;                            FirebaseUser signed = result.getUser();&#10;                            if (signed != null) {&#10;                                prefs.edit().putString(&quot;UID&quot;, signed.getUid()).apply();&#10;                            }&#10;                            if (&quot;admin&quot;.equals(role)) {&#10;                                startActivity(new Intent(this, AdminActivity.class));&#10;                            } else {&#10;                                startActivity(new Intent(this, MainActivity.class));&#10;                            }&#10;                            finish();&#10;                        })&#10;                        .addOnFailureListener(e -&gt; {&#10;                            // If silent sign-in fails, fall back to show auth UI&#10;                            setContentView(R.layout.activity_auth);&#10;                        });&#10;            } else {&#10;                // No preserved credentials/role =&gt; stay on auth screen&#10;                setContentView(R.layout.activity_auth);&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you.ui.auth;&#10;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.os.Bundle;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.ui.admin.AdminActivity;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.auth.FirebaseUser;&#10;&#10;public class AuthActivity extends AppCompatActivity {&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;&#10;        FirebaseAuth auth = FirebaseAuth.getInstance();&#10;        FirebaseUser user = auth.getCurrentUser();&#10;        SharedPreferences prefs = getSharedPreferences(&quot;AuthPreferences&quot;, MODE_PRIVATE);&#10;&#10;        // Determine role stored in preferences (if any)&#10;        String role = prefs.getString(&quot;Role&quot;, null); // expected values: &quot;admin&quot; or &quot;user&quot;&#10;&#10;        if (user != null) {&#10;            // If Firebase user exists, route by stored role if present, otherwise go to main&#10;            if (role != null &amp;&amp; role.equals(&quot;admin&quot;)) {&#10;                startActivity(new Intent(this, AdminActivity.class));&#10;                finish();&#10;                return;&#10;            } else {&#10;                startActivity(new Intent(this, MainActivity.class));&#10;                finish();&#10;                return;&#10;            }&#10;        } else {&#10;            String uid = prefs.getString(&quot;UID&quot;, null);&#10;            String token = prefs.getString(&quot;Token&quot;, null);&#10;&#10;            // Only attempt anonymous sign-in if we still have UID or Token and role is present.&#10;            if ((uid != null || token != null) &amp;&amp; role != null) {&#10;                auth.signInAnonymously()&#10;                        .addOnSuccessListener(result -&gt; {&#10;                            FirebaseUser signed = result.getUser();&#10;                            if (signed != null) {&#10;                                prefs.edit().putString(&quot;UID&quot;, signed.getUid()).apply();&#10;                            }&#10;                            if (&quot;admin&quot;.equals(role)) {&#10;                                startActivity(new Intent(this, AdminActivity.class));&#10;                            } else {&#10;                                startActivity(new Intent(this, MainActivity.class));&#10;                            }&#10;                            finish();&#10;                        })&#10;                        .addOnFailureListener(e -&gt; {&#10;                            // If silent sign-in fails, fall back to show auth UI&#10;                            setContentView(R.layout.activity_auth);&#10;                        });&#10;            } else {&#10;                // No preserved credentials/role =&gt; stay on auth screen&#10;                setContentView(R.layout.activity_auth);&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/auth/LoginFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/auth/LoginFragment.java" />
              <option name="originalContent" value="package com.example.sound4you.ui.auth;&#10;&#10;import android.os.Bundle;&#10;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import android.content.Intent;&#10;import android.widget.Button;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.presenter.auth.LoginPresenterImpl;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.ui.admin.AdminActivity;&#10;&#10;import com.google.android.material.textfield.TextInputEditText;&#10;&#10;public class LoginFragment extends Fragment implements AuthView{&#10;&#10;    private TextInputEditText emailInput;&#10;    private TextInputEditText passwordInput;&#10;    private ProgressBar progressBar;&#10;    private Button loginButton;&#10;    private LoginPresenterImpl presenter;&#10;&#10;    public LoginFragment() {&#10;&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater,&#10;                             @Nullable ViewGroup container,&#10;                             @Nullable Bundle savedInstanceState) {&#10;&#10;        View view = inflater.inflate(R.layout.fragment_login, container, false);&#10;        emailInput = view.findViewById(R.id.emailInput);&#10;        passwordInput = view.findViewById(R.id.passwordInput);&#10;        loginButton = view.findViewById(R.id.loginButton);&#10;        progressBar = new ProgressBar(requireContext());&#10;&#10;        presenter = new LoginPresenterImpl(this, requireContext());&#10;        loginButton.setOnClickListener(v -&gt; {&#10;            String email = emailInput.getText().toString();&#10;            String password = passwordInput.getText().toString();&#10;            presenter.login(email, password);&#10;        });&#10;&#10;        TextView tvForgotPassword = view.findViewById(R.id.forgotPassword);&#10;        TextView tvGotoRegister = view.findViewById(R.id.registerAccount);&#10;&#10;        tvForgotPassword.setOnClickListener(v-&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_passwordForgettingFragment);&#10;        });&#10;&#10;        tvGotoRegister.setOnClickListener(v -&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_registerFragment);&#10;        });&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void showLoading() {&#10;        progressBar.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;        progressBar.setVisibility(View.GONE);&#10;    }&#10;&#10;    @Override&#10;    public void onSuccess (String message) {&#10;        if (message != null &amp;&amp; message.equals(&quot;admin&quot;)) {&#10;            startActivity(new Intent(getContext(), AdminActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;        else {&#10;            startActivity(new Intent(getContext(), MainActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onError (String message) {&#10;        Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.sound4you.ui.auth;&#10;&#10;import android.os.Bundle;&#10;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import android.content.Intent;&#10;import android.widget.Button;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.navigation.fragment.NavHostFragment;&#10;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.presenter.auth.LoginPresenterImpl;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.ui.admin.AdminActivity;&#10;&#10;import com.google.android.material.textfield.TextInputEditText;&#10;&#10;public class LoginFragment extends Fragment implements AuthView{&#10;&#10;    private TextInputEditText emailInput;&#10;    private TextInputEditText passwordInput;&#10;    private ProgressBar progressBar;&#10;    private Button loginButton;&#10;    private LoginPresenterImpl presenter;&#10;&#10;    public LoginFragment() {&#10;&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater,&#10;                             @Nullable ViewGroup container,&#10;                             @Nullable Bundle savedInstanceState) {&#10;&#10;        View view = inflater.inflate(R.layout.fragment_login, container, false);&#10;        emailInput = view.findViewById(R.id.emailInput);&#10;        passwordInput = view.findViewById(R.id.passwordInput);&#10;        loginButton = view.findViewById(R.id.loginButton);&#10;        progressBar = new ProgressBar(requireContext());&#10;&#10;        presenter = new LoginPresenterImpl(this, requireContext());&#10;        loginButton.setOnClickListener(v -&gt; {&#10;            String email = emailInput.getText().toString();&#10;            String password = passwordInput.getText().toString();&#10;            presenter.login(email, password);&#10;        });&#10;&#10;        TextView tvForgotPassword = view.findViewById(R.id.forgotPassword);&#10;        TextView tvGotoRegister = view.findViewById(R.id.registerAccount);&#10;&#10;        tvForgotPassword.setOnClickListener(v-&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_passwordForgettingFragment);&#10;        });&#10;&#10;        tvGotoRegister.setOnClickListener(v -&gt; {&#10;            NavHostFragment.findNavController(this).navigate(R.id.action_loginFragment_to_registerFragment);&#10;        });&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void showLoading() {&#10;        progressBar.setVisibility(View.VISIBLE);&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;        progressBar.setVisibility(View.GONE);&#10;    }&#10;&#10;    @Override&#10;    public void onSuccess (String message) {&#10;        if (message != null &amp;&amp; message.equals(&quot;admin&quot;)) {&#10;            startActivity(new Intent(getContext(), AdminActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;        else {&#10;            startActivity(new Intent(getContext(), MainActivity.class));&#10;            requireActivity().finish();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onError (String message) {&#10;        Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/feed/FeedFollowingFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/feed/FeedFollowingFragment.java" />
              <option name="originalContent" value="package com.example.sound4you.ui.feed;&#10;&#10;import android.os.Bundle;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.presenter.feed.FeedFollowingPresenter;&#10;import com.example.sound4you.presenter.feed.FeedFollowingPresenterImpl;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.auth.FirebaseUser;&#10;&#10;import java.util.List;&#10;import java.util.ArrayList;&#10;&#10;public class FeedFollowingFragment extends Fragment implements FeedView{&#10;    private RecyclerView rvFeedFollowing;&#10;    private FeedFollowingAdapter adapter;&#10;    private List&lt;Track&gt; data = new ArrayList&lt;&gt;();&#10;    private FeedFollowingPresenter presenter;&#10;    private String firebaseId;&#10;&#10;    public FeedFollowingFragment() {&#10;        // Required empty public constructor&#10;    }&#10;&#10;    @Override&#10;    public View onCreateView(LayoutInflater inflater, ViewGroup container,&#10;                             Bundle savedInstanceState) {&#10;        View v = inflater.inflate(R.layout.fragment_feed_following, container, false);&#10;&#10;        rvFeedFollowing = v.findViewById(R.id.rvFeedFollowing);&#10;&#10;        rvFeedFollowing.setLayoutManager(new LinearLayoutManager(getContext()));&#10;        adapter = new FeedFollowingAdapter(getContext(), data);&#10;        rvFeedFollowing.setAdapter(adapter);&#10;&#10;        FirebaseUser user = FirebaseAuth.getInstance().getCurrentUser();&#10;        firebaseId = user != null ? user.getUid() : null;&#10;&#10;        presenter = new FeedFollowingPresenterImpl(this);&#10;&#10;        presenter.loadFollowingFeed(firebaseId);&#10;&#10;        return v;&#10;    }&#10;&#10;    @Override&#10;    public void showFeed(List&lt;Track&gt; tracks) {&#10;        rvFeedFollowing.setVisibility(View.VISIBLE);&#10;        data.clear();&#10;        data.addAll(tracks);&#10;        adapter.notifyDataSetChanged();&#10;    }&#10;&#10;    @Override&#10;    public void showError(String message) {&#10;        Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void showLoading() {&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.sound4you.ui.feed;&#10;&#10;import android.os.Bundle;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.presenter.feed.FeedFollowingPresenter;&#10;import com.example.sound4you.presenter.feed.FeedFollowingPresenterImpl;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.auth.FirebaseUser;&#10;&#10;import java.util.List;&#10;import java.util.ArrayList;&#10;&#10;public class FeedFollowingFragment extends Fragment implements FeedView{&#10;    private RecyclerView rvFeedFollowing;&#10;    private FeedFollowingAdapter adapter;&#10;    private List&lt;Track&gt; data = new ArrayList&lt;&gt;();&#10;    private FeedFollowingPresenter presenter;&#10;    private String firebaseId;&#10;&#10;    public FeedFollowingFragment() {&#10;        // Required empty public constructor&#10;    }&#10;&#10;    @Override&#10;    public View onCreateView(LayoutInflater inflater, ViewGroup container,&#10;                             Bundle savedInstanceState) {&#10;        View v = inflater.inflate(R.layout.fragment_feed_following, container, false);&#10;&#10;        rvFeedFollowing = v.findViewById(R.id.rvFeedFollowing);&#10;&#10;        rvFeedFollowing.setLayoutManager(new LinearLayoutManager(getContext()));&#10;        adapter = new FeedFollowingAdapter(getContext(), data);&#10;        rvFeedFollowing.setAdapter(adapter);&#10;&#10;        FirebaseUser user = FirebaseAuth.getInstance().getCurrentUser();&#10;        firebaseId = user != null ? user.getUid() : null;&#10;&#10;        presenter = new FeedFollowingPresenterImpl(this);&#10;&#10;        presenter.loadFollowingFeed(firebaseId);&#10;&#10;        return v;&#10;    }&#10;&#10;    @Override&#10;    public void showFeed(List&lt;Track&gt; tracks) {&#10;        rvFeedFollowing.setVisibility(View.VISIBLE);&#10;        data.clear();&#10;        data.addAll(tracks);&#10;        adapter.notifyDataSetChanged();&#10;    }&#10;&#10;    @Override&#10;    public void showError(String message) {&#10;        Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void showLoading() {&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/profile/ProfileFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sound4you/ui/profile/ProfileFragment.java" />
              <option name="originalContent" value="package com.example.sound4you.ui.profile;&#10;&#10;import android.app.AlertDialog;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.view.*;&#10;import android.widget.*;&#10;import android.os.Bundle;&#10;import androidx.annotation.*;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;import com.bumptech.glide.Glide;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.data.model.User;&#10;import com.example.sound4you.presenter.like.LikePresenterImpl;&#10;import com.example.sound4you.presenter.profile.ProfilePresenterImpl;&#10;import com.example.sound4you.presenter.track.TrackPresenterImpl;&#10;import com.example.sound4you.ui.auth.AuthActivity;&#10;import com.example.sound4you.ui.follow.FollowerListFragment;&#10;import com.example.sound4you.ui.follow.FollowingListFragment;&#10;import com.example.sound4you.ui.follow.EditProfileFragment;&#10;import com.example.sound4you.ui.stream.LikeStreamView;&#10;import com.example.sound4you.ui.track.TrackView;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import java.util.List;&#10;&#10;public class ProfileFragment extends Fragment implements ProfileView, TrackView {&#10;    private ImageButton btnLogOut, btnEdit;&#10;    private ImageView ivAvatar;&#10;    private TextView tvName, tvBio, tvFollowers, tvFollowing;&#10;    private RecyclerView rvUploads;&#10;    private View uploadsHeader, likesHeader;&#10;    private LinearLayout followerContainer, followingContainer;&#10;&#10;    private ProfilePresenterImpl profilePresenter;&#10;    private TrackPresenterImpl trackPresenter;&#10;    private LikePresenterImpl likePresenter;&#10;&#10;    private boolean isSelf;&#10;    private int userId;&#10;    private String firebaseUid;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View v = inflater.inflate(R.layout.fragment_profile, container, false);&#10;&#10;        btnLogOut = v.findViewById(R.id.btnLogOut);&#10;        btnEdit = v.findViewById(R.id.btnEditProfile);&#10;        ivAvatar = v.findViewById(R.id.profilePicture);&#10;        tvName = v.findViewById(R.id.tvNameUser);&#10;        tvBio = v.findViewById(R.id.tvBioUser);&#10;        tvFollowers = v.findViewById(R.id.tvNumberFollowers);&#10;        tvFollowing = v.findViewById(R.id.tvNumberFollowing);&#10;        rvUploads = v.findViewById(R.id.rvUploadTracks);&#10;        uploadsHeader = v.findViewById(R.id.uploadTrackUserContainer);&#10;        likesHeader = v.findViewById(R.id.loveTrackUserContainer);&#10;        followerContainer = v.findViewById(R.id.followerContainer);&#10;        followingContainer = v.findViewById(R.id.followingContainer);&#10;&#10;        rvUploads.setLayoutManager(new LinearLayoutManager(getContext()));&#10;        firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        profilePresenter = new ProfilePresenterImpl(this);&#10;        trackPresenter = new TrackPresenterImpl(this);&#10;        likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override&#10;            public void onLikeChanged(boolean liked) {}&#10;            @Override&#10;            public void onLikeStatusChecked(boolean liked) {}&#10;            @Override&#10;            public void onTracksUpdated(List&lt;Track&gt; tracks) {&#10;                TrackAdapterUpload adapter = new TrackAdapterUpload(requireContext(), tracks, isSelf);&#10;                rvUploads.setAdapter(adapter);&#10;                adapter.notifyDataSetChanged();&#10;            }&#10;            @Override&#10;            public void onError(String msg) {}&#10;        });&#10;&#10;        if (getArguments() != null &amp;&amp; getArguments().containsKey(&quot;userId&quot;)) {&#10;            userId = getArguments().getInt(&quot;userId&quot;);&#10;            isSelf = false;&#10;            profilePresenter.loadProfileById(userId);&#10;            trackPresenter.loadTracksByUserLimited(userId, 3);&#10;            btnEdit.setVisibility(View.GONE);&#10;            likesHeader.setVisibility(View.GONE);&#10;            // hide bottom nav via MainActivity helper&#10;            if (getActivity() instanceof com.example.sound4you.MainActivity) {&#10;                ((com.example.sound4you.MainActivity) getActivity()).hideBottomNav();&#10;            }&#10;        } else {&#10;            isSelf = true;&#10;            profilePresenter.loadProfileByFirebase(firebaseUid);&#10;            btnEdit.setVisibility(View.VISIBLE);&#10;        }&#10;&#10;        uploadsHeader.setOnClickListener(v1 -&gt; navigate(UploadTrackListFragment.newInstance(userId, isSelf)));&#10;        likesHeader.setOnClickListener(v2 -&gt; {&#10;            if (isSelf) navigate(LikedTrackListFragment.newInstance(firebaseUid));&#10;        });&#10;&#10;        btnEdit.setOnClickListener(v3 -&gt; navigate(EditProfileFragment.newInstance()));&#10;&#10;        btnLogOut.setOnClickListener(v1 -&gt; new AlertDialog.Builder(requireContext())&#10;                .setTitle(&quot;Đăng xuất&quot;)&#10;                .setMessage(&quot;Bạn có chắc muốn đăng xuất không?&quot;)&#10;                .setPositiveButton(&quot;Đăng xuất&quot;, (d, w) -&gt; {&#10;                    FirebaseAuth.getInstance().signOut();&#10;&#10;                    // Clear both preference stores used by auth flows to avoid automatic re-login&#10;                    SharedPreferences prefs1 = requireContext().getSharedPreferences(&quot;user_prefs&quot;, Context.MODE_PRIVATE);&#10;                    prefs1.edit().clear().apply();&#10;                    SharedPreferences prefs2 = requireContext().getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;                    prefs2.edit().clear().apply();&#10;&#10;                    Intent intent = new Intent(requireContext(), AuthActivity.class);&#10;                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);&#10;                    startActivity(intent);&#10;                    requireActivity().finish();&#10;                })&#10;                .setNegativeButton(&quot;Hủy&quot;, null)&#10;                .show());&#10;&#10;        followerContainer.setOnClickListener(v4 -&gt; {&#10;            navigate(FollowerListFragment.newInstance());&#10;        });&#10;&#10;        followingContainer.setOnClickListener(v5 -&gt; {&#10;            navigate(FollowingListFragment.newInstance());&#10;        });&#10;&#10;        return v;&#10;    }&#10;&#10;    private void navigate(Fragment f) {&#10;        requireActivity().getSupportFragmentManager()&#10;                .beginTransaction()&#10;                .replace(R.id.navHostFragment, f)&#10;                .addToBackStack(null)&#10;                .commit();&#10;    }&#10;&#10;    @Override public void showLoading() {}&#10;    @Override public void hideLoading() {}&#10;    @Override public void onError(String msg) {&#10;        Toast.makeText(requireContext(), msg, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void onProfileLoaded(User user) {&#10;        this.userId = user.getId();&#10;        tvName.setText(user.getUsername());&#10;        tvBio.setText(user.getBio());&#10;        tvFollowers.setText(String.valueOf(user.getFollowers()));&#10;        tvFollowing.setText(String.valueOf(user.getFollowing()));&#10;&#10;        Glide.with(this)&#10;                .load(user.getProfile_picture())&#10;                .placeholder(R.drawable.ic_avatar_placeholder)&#10;                .into(ivAvatar);&#10;&#10;        if (isSelf) trackPresenter.loadTracksByFirebaseLimited(firebaseUid, 3);&#10;    }&#10;&#10;    @Override&#10;    public void onTracksLoaded(List&lt;Track&gt; tracks) {&#10;        TrackAdapterUpload adapter = new TrackAdapterUpload(requireContext(), tracks, isSelf);&#10;&#10;        likePresenter.checkLikes(firebaseUid, tracks);&#10;&#10;        adapter.setOnItemClick(track -&gt; {&#10;            if (getActivity() instanceof MainActivity)&#10;                ((MainActivity) getActivity()).showNowPlaying(track);&#10;        });&#10;&#10;        adapter.setOnLikeClick((track, liked) -&gt; {&#10;            likePresenter.likeTrack(firebaseUid, track.getId(), liked);&#10;        });&#10;&#10;        rvUploads.setAdapter(adapter);&#10;    }&#10;&#10;    @Override&#10;    public void onProfileUpdated(User user) {&#10;        Toast.makeText(requireContext(), &quot;Profile updated!&quot;, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void onDestroyView() {&#10;        super.onDestroyView();&#10;        if (getActivity() instanceof com.example.sound4you.MainActivity) {&#10;            ((com.example.sound4you.MainActivity) getActivity()).showBottomNav();&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.sound4you.ui.profile;&#10;&#10;import android.app.AlertDialog;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.view.*;&#10;import android.widget.*;&#10;import android.os.Bundle;&#10;import androidx.annotation.*;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;import com.bumptech.glide.Glide;&#10;import com.example.sound4you.MainActivity;&#10;import com.example.sound4you.R;&#10;import com.example.sound4you.data.model.Track;&#10;import com.example.sound4you.data.model.User;&#10;import com.example.sound4you.presenter.like.LikePresenterImpl;&#10;import com.example.sound4you.presenter.profile.ProfilePresenterImpl;&#10;import com.example.sound4you.presenter.track.TrackPresenterImpl;&#10;import com.example.sound4you.ui.auth.AuthActivity;&#10;import com.example.sound4you.ui.follow.FollowerListFragment;&#10;import com.example.sound4you.ui.follow.FollowingListFragment;&#10;import com.example.sound4you.ui.follow.EditProfileFragment;&#10;import com.example.sound4you.ui.stream.LikeStreamView;&#10;import com.example.sound4you.ui.track.TrackView;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import java.util.List;&#10;&#10;public class ProfileFragment extends Fragment implements ProfileView, TrackView {&#10;    private ImageButton btnLogOut, btnEdit;&#10;    private ImageView ivAvatar;&#10;    private TextView tvName, tvBio, tvFollowers, tvFollowing;&#10;    private RecyclerView rvUploads;&#10;    private View uploadsHeader, likesHeader;&#10;    private LinearLayout followerContainer, followingContainer;&#10;&#10;    private ProfilePresenterImpl profilePresenter;&#10;    private TrackPresenterImpl trackPresenter;&#10;    private LikePresenterImpl likePresenter;&#10;&#10;    private boolean isSelf;&#10;    private int userId;&#10;    private String firebaseUid;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View v = inflater.inflate(R.layout.fragment_profile, container, false);&#10;&#10;        btnLogOut = v.findViewById(R.id.btnLogOut);&#10;        btnEdit = v.findViewById(R.id.btnEditProfile);&#10;        ivAvatar = v.findViewById(R.id.profilePicture);&#10;        tvName = v.findViewById(R.id.tvNameUser);&#10;        tvBio = v.findViewById(R.id.tvBioUser);&#10;        tvFollowers = v.findViewById(R.id.tvNumberFollowers);&#10;        tvFollowing = v.findViewById(R.id.tvNumberFollowing);&#10;        rvUploads = v.findViewById(R.id.rvUploadTracks);&#10;        uploadsHeader = v.findViewById(R.id.uploadTrackUserContainer);&#10;        likesHeader = v.findViewById(R.id.loveTrackUserContainer);&#10;        followerContainer = v.findViewById(R.id.followerContainer);&#10;        followingContainer = v.findViewById(R.id.followingContainer);&#10;&#10;        rvUploads.setLayoutManager(new LinearLayoutManager(getContext()));&#10;        firebaseUid = FirebaseAuth.getInstance().getCurrentUser().getUid();&#10;&#10;        profilePresenter = new ProfilePresenterImpl(this);&#10;        trackPresenter = new TrackPresenterImpl(this);&#10;        likePresenter = new LikePresenterImpl(new LikeStreamView() {&#10;            @Override&#10;            public void onLikeChanged(boolean liked) {}&#10;            @Override&#10;            public void onLikeStatusChecked(boolean liked) {}&#10;            @Override&#10;            public void onTracksUpdated(List&lt;Track&gt; tracks) {&#10;                TrackAdapterUpload adapter = new TrackAdapterUpload(requireContext(), tracks, isSelf);&#10;                rvUploads.setAdapter(adapter);&#10;                adapter.notifyDataSetChanged();&#10;            }&#10;            @Override&#10;            public void onError(String msg) {}&#10;        });&#10;&#10;        if (getArguments() != null &amp;&amp; getArguments().containsKey(&quot;userId&quot;)) {&#10;            userId = getArguments().getInt(&quot;userId&quot;);&#10;            isSelf = false;&#10;            profilePresenter.loadProfileById(userId);&#10;            trackPresenter.loadTracksByUserLimited(userId, 3);&#10;            btnEdit.setVisibility(View.GONE);&#10;            likesHeader.setVisibility(View.GONE);&#10;            // hide bottom nav via MainActivity helper&#10;            if (getActivity() instanceof com.example.sound4you.MainActivity) {&#10;                ((com.example.sound4you.MainActivity) getActivity()).hideBottomNav();&#10;            }&#10;        } else {&#10;            isSelf = true;&#10;            profilePresenter.loadProfileByFirebase(firebaseUid);&#10;            btnEdit.setVisibility(View.VISIBLE);&#10;        }&#10;&#10;        uploadsHeader.setOnClickListener(v1 -&gt; navigate(UploadTrackListFragment.newInstance(userId, isSelf)));&#10;        likesHeader.setOnClickListener(v2 -&gt; {&#10;            if (isSelf) navigate(LikedTrackListFragment.newInstance(firebaseUid));&#10;        });&#10;&#10;        btnEdit.setOnClickListener(v3 -&gt; navigate(EditProfileFragment.newInstance()));&#10;&#10;        btnLogOut.setOnClickListener(v1 -&gt; new AlertDialog.Builder(requireContext())&#10;                .setTitle(&quot;Đăng xuất&quot;)&#10;                .setMessage(&quot;Bạn có chắc muốn đăng xuất không?&quot;)&#10;                .setPositiveButton(&quot;Đăng xuất&quot;, (d, w) -&gt; {&#10;                    FirebaseAuth.getInstance().signOut();&#10;&#10;                    // Clear both preference stores used by auth flows to avoid automatic re-login&#10;                    SharedPreferences prefs1 = requireContext().getSharedPreferences(&quot;user_prefs&quot;, Context.MODE_PRIVATE);&#10;                    prefs1.edit().clear().apply();&#10;                    SharedPreferences prefs2 = requireContext().getSharedPreferences(&quot;AuthPreferences&quot;, Context.MODE_PRIVATE);&#10;                    prefs2.edit().clear().apply();&#10;&#10;                    Intent intent = new Intent(requireContext(), AuthActivity.class);&#10;                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);&#10;                    startActivity(intent);&#10;                    requireActivity().finish();&#10;                })&#10;                .setNegativeButton(&quot;Hủy&quot;, null)&#10;                .show());&#10;&#10;        followerContainer.setOnClickListener(v4 -&gt; {&#10;            navigate(FollowerListFragment.newInstance());&#10;        });&#10;&#10;        followingContainer.setOnClickListener(v5 -&gt; {&#10;            navigate(FollowingListFragment.newInstance());&#10;        });&#10;&#10;        return v;&#10;    }&#10;&#10;    private void navigate(Fragment f) {&#10;        requireActivity().getSupportFragmentManager()&#10;                .beginTransaction()&#10;                .replace(R.id.navHostFragment, f)&#10;                .addToBackStack(null)&#10;                .commit();&#10;    }&#10;&#10;    @Override public void showLoading() {}&#10;    @Override public void hideLoading() {}&#10;    @Override public void onError(String msg) {&#10;        Toast.makeText(requireContext(), msg, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void onProfileLoaded(User user) {&#10;        this.userId = user.getId();&#10;        tvName.setText(user.getUsername());&#10;        tvBio.setText(user.getBio());&#10;        tvFollowers.setText(String.valueOf(user.getFollowers()));&#10;        tvFollowing.setText(String.valueOf(user.getFollowing()));&#10;&#10;        Glide.with(this)&#10;                .load(user.getProfile_picture())&#10;                .placeholder(R.drawable.ic_avatar_placeholder)&#10;                .into(ivAvatar);&#10;&#10;        if (isSelf) trackPresenter.loadTracksByFirebaseLimited(firebaseUid, 3);&#10;    }&#10;&#10;    @Override&#10;    public void onTracksLoaded(List&lt;Track&gt; tracks) {&#10;        TrackAdapterUpload adapter = new TrackAdapterUpload(requireContext(), tracks, isSelf);&#10;&#10;        likePresenter.checkLikes(firebaseUid, tracks);&#10;&#10;        adapter.setOnItemClick(track -&gt; {&#10;            if (getActivity() instanceof MainActivity)&#10;                ((MainActivity) getActivity()).showNowPlaying(track);&#10;        });&#10;&#10;        adapter.setOnLikeClick((track, liked) -&gt; {&#10;            likePresenter.likeTrack(firebaseUid, track.getId(), liked);&#10;        });&#10;&#10;        rvUploads.setAdapter(adapter);&#10;    }&#10;&#10;    @Override&#10;    public void onProfileUpdated(User user) {&#10;        Toast.makeText(requireContext(), &quot;Profile updated!&quot;, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void onDestroyView() {&#10;        super.onDestroyView();&#10;        if (getActivity() instanceof com.example.sound4you.MainActivity) {&#10;            ((com.example.sound4you.MainActivity) getActivity()).showBottomNav();&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>